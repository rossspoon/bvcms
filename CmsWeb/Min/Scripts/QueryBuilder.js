function HighlightCondition(){$("#ConditionGrid li a").removeClass("SelectedRow"),$("#ConditionGrid li a#"+$("#SelectedId").val()).addClass("SelectedRow"),$("#ConditionGrid li a").click(EditCondition),$(".conditionPopup").contextMenu({menu:"InsCopyMenu"},function(n,t){switch(n){case"ins":$.post("/QueryBuilder/InsGroupAbove/"+$(t).attr("id"),null,function(n){$.navigate("/QueryBuilder/Main/"+n)});break;case"copy":$.post("/QueryBuilder/CopyAsNew/"+$(t).attr("id"),null,function(n){$.navigate("/QueryBuilder/Main/"+n)})}})}function FillConditionGrid(n){$("#ConditionGrid").html(n).ready(function(){HighlightCondition(),$("#ConditionGrid li a").click(EditCondition)})}function RefreshList(){$.block(),$.ajax({type:"POST",url:"/QueryBuilder/Results/",data:qs,timeout:12e5,success:function(n){$("#toolbar").show(),$("#Results").html(n),$("#people tbody tr:even").addClass("alt"),$("a.taguntag").click(function(n){return $.post("/QueryBuilder/ToggleTag/"+$(this).attr("value"),null,function(t){t.error?alert(t.error):$(n.target).text(t.HasTag?"Remove":"Add")}),!1}),$("#people thead a.sortable").click(function(){var i=$(this).text(),r=$("#Sort").val(),t;return $("#Sort").val(i),t=$("#Direction").val(),r==i&&t=="asc"?$("#Direction").val("desc"):$("#Direction").val("asc"),qs=$("#conditionForm").serialize(),RefreshList(),!1}),$.unblock()},error:function(n,t,i){$.unblock(),alert(i)}})}function GotoPage(n){return qs=$("#conditionForm").serialize()+"&Page="+n,RefreshList(),!1}function SetPageSize(n){return qs=$("#conditionForm").serialize()+"&PageSize="+n,RefreshList(),!1}function CascadeDivision(){$("#Division").change(function(){$.post("/QueryBuilder/GetOrganizations/"+$(this).val(),null,function(n){$("#Organization").fillOptions(n),$("#selectconditions select").css("width","100%")})})}function CascadeComparison(){$("#Comparison").change(function(){$.post("/QueryBuilder/GetCodes/",{ConditionName:$("#ConditionName").val(),Comparison:$("#Comparison").val()},function(n){UpdateCodes(n)})})}function EditCondition(){$("#ConditionGrid li").removeClass("SelectedRow");var t=$(this).parent("li").attr("id");return $("#ConditionGrid li#"+t).addClass("SelectedRow"),$.post("/QueryBuilder/EditCondition/"+t,null,function(n){UpdateView(n)}),!1}function UpdateCodes(n){$("#CodeValues").multiselect("destroy"),$("#CodeValues").remove(),$("#CodeValue").remove(),(n.CodeVisible||n.CodesVisible)&&(n.SelectMultiple?($("#values").after('<select id="CodeValues"></select>'),$("#CodeValues").fillOptions(n.CodeData,!0),$("#CodeValues").multiselect()):($("#values").after('<select id="CodeValue"></select>'),$("#CodeValue").fillOptions(n.CodeData)))}function ShowErrors(n){$(".validate").each(function(){$(this).next(".error").remove()});var t=eval("("+n+")");return t.count==0?!1:($(".validate").each(function(){t[this.id]&&$(this).after("<span class='error'> "+t[this.id]+"</span>")}),!0)}function UpdateView(n){$("#SelectedId").val(n.SelectedId),UpdateCodes(n),$("#Comparison").fillOptions(n.CompareData),(n.CodeVisible||n.CodesVisible)&&CascadeComparison(),$("#Division").fillOptions(n.DivisionData),CascadeDivision(),$("#Organization").fillOptions(n.OrganizationData),$("#TagsDiv").showhide(n.TagsVisible),n.TagsVisible&&($("#tagvalues").multiSelectRemove(),$("#Tags").remove(),$("#tagvalues").after('<select id="Tags"></select>'),$("#Tags").fillOptions(n.TagData,!0),$("#Tags").multiselect()),$("#ConditionName").val(n.ConditionName),$("#ConditionText").text(n.ConditionText),$("#TextValue").val(n.TextValue),$("#IntegerValue").val(n.IntegerValue),$("#NumberValue").val(n.NumberValue),$("#DateValue").val(n.DateValue),n.CodeValue!=""&&$("#CodeValue").val(n.CodeValue),$("#CodesValue").val(n.CodesValue),$("#Program").val(n.Program),$("#Division").val(n.Division),$("#Organization").val(n.Organization),$("#View").val(n.View),$("#SavedQueryDesc").val(n.SavedQueryDesc),$("#Ministry").val(n.Ministry),$("#Schedule").val(n.Schedule),$("#Campus").val(n.Campus),$("#OrgType").val(n.OrgType),$("#Days").val(n.Days),$("#Age").val(n.Age),$("#Quarters").val(n.Quarters),$("#StartDate").val(n.StartDate),$("#EndDate").val(n.EndDate),n.Comparison?$("#Comparison").val(n.Comparison):$("#Comparison")[0].selected=!0,$("#SchedDiv").showhide(n.ScheduleVisible),$("#CampusDiv").showhide(n.CampusVisible),$("#OrgTypeDiv").showhide(n.OrgTypeVisible),$("#ProgDiv").showhide(n.ProgramVisible),$("#DivDiv").showhide(n.DivisionVisible),$("#EndDiv").showhide(n.EndDateVisible),$("#StartDiv").showhide(n.StartDateVisible),$("#OrgDiv").showhide(n.OrganizationVisible),$("#ViewDiv").showhide(n.ViewVisible),$("#DaysDiv").showhide(n.DaysVisible),$("#AgeDiv").showhide(n.AgeVisible),$("#OtherLabel").text(n.OtherLabel),$("#SavedQueryDiv").showhide(n.SavedQueryVisible),$("#MinistryDiv").showhide(n.MinistryVisible),$("#QuartersDiv").showhide(n.QuartersVisible),$("#QuartersLabel").text(n.QuartersLabel),$("#RightPanel").showhide(n.RightPanelVisible),$("#TextValue").showhide(n.TextVisible),$("#CodeValue").showhide(n.CodeVisible),$("#CodesValue").showhide(n.CodesVisible),$("#DateValue").showhide(n.DateVisible),$("#NumberValue").showhide(n.NumberVisible),$("#IntegerValue").showhide(n.IntegerVisible),$("#Update").enabled(n.UpdateEnabled),$("#Add").enabled(n.AddEnabled),$("#AddToGroup").enabled(n.AddToGroupEnabled),$("#Remove").enabled(n.RemoveEnabled),$("#selectconditions select").css("width","100%")}var qs="";$(function(){$("#SelectCondition").SelectCondition(),$("#QueryConditionHelp").dialog({title:"Help on Condition",bgiframe:!0,autoOpen:!1,width:750,height:700,modal:!0,overlay:{opacity:.5,background:"black"},close:function(){$("iframe",this).attr("src","")}}),$("a.help").live("click",function(n){n.preventDefault();var t=$("#QueryConditionHelp");this.href.endsWith("-")?$("iframe",t).attr("src",this.href+$("#ConditionName").val()):$("iframe",t).attr("src",this.href),t.dialog("open")}),$("a.help,.helptip").tooltip({showBody:"|",showURL:!1}),$("#Tags").click(function(){$("#TagsPopup").show()}),$(".datepicker").datepicker(),$(".bt").button(),$("#selectconditions select").css("width","100%"),$("#targetpeople").click(function(n){return n.preventDefault(),$('a.target[target="people"]').length==0?$("a.target").attr("target","people"):$("a.target").removeAttr("target"),!1}),HighlightCondition(),$("#Program").change(function(){$.post("/QueryBuilder/GetDivisions/"+$(this).val(),null,function(n){$("#Division").fillOptions(n.Divisions),$("#Organization").fillOptions(n.Organizations),CascadeDivision(),$("#selectconditions select").css("width","100%")})}),$("#AddToGroup[href]").live("click",function(){return qs=$("#conditionForm").serialize(),$.post("/QueryBuilder/AddToGroup/",qs,function(n){var t=n.split("<---------->");ShowErrors(t[1])||FillConditionGrid(t[0])}),!1}),$("#Add[href]").live("click",function(){return qs=$("#conditionForm").serialize(),$.post("/QueryBuilder/Add/",qs,function(n){var t=n.split("<---------->");ShowErrors(t[1])||FillConditionGrid(t[0])}),!1}),$("#Update[href]").live("click",function(){return qs=$("#conditionForm").serialize(),$.post("/QueryBuilder/Update/",qs,function(n){var t=n.split("<---------->");ShowErrors(t[1])||FillConditionGrid(t[0])}),!1}),$("#Remove[href]").live("click",function(){return qs=$("#conditionForm").serialize(),$.post("/QueryBuilder/Remove/",qs,function(n){UpdateView(n),$.post("/QueryBuilder/Conditions/",null,function(n){FillConditionGrid(n)})}),!1}),$("#Run").click(function(){return qs=$("#conditionForm").serialize(),RefreshList(),!1}),$("#Export").click(function(){window.location="QueryBuilder/Export/"+$("#QueryId").val()}),dialogOptions={overlay:{background:"#000",opacity:.3},bgiframe:!0,modal:!0,autoOpen:!1,closeOnEscape:!0,width:500},$("#SaveQueryDiv").dialog(dialogOptions),$("#OpenQueryDiv").dialog(dialogOptions),$("#ShowSaveQuery").click(function(){$("#SaveQueryDesc").val($("#Description").text()),$("#SaveQueryDiv").dialog("open")}),$("#ShowOpenQuery").click(function(){return $.post("/QueryBuilder/SavedQueries",null,function(n){$("#ExistingQueries").fillOptions(n)}),$("#OpenQueryDiv").dialog("open"),!1}),$("#OpenQuery").click(function(){$("#OpenQueryDiv").dialog("close");var t=$("#ExistingQueries").val().split(":");window.location="/QueryBuilder/Main/"+t[0]}),$("#SaveQuery").click(function(){return $("#SaveQueryDiv").dialog("close"),$.post("/QueryBuilder/SaveQuery/",{SavedQueryDesc:$("#SaveQueryDesc").val(),IsPublic:$("#IsPublic").is(":checked")},function(n){$("#Description").text(n)}),!1})}),function(n){n.QueryString=function(t,i){var r={};return n.each(t.split("&"),function(){var n=this.split("=");r[n[0]]=n[1]}),r[i]},n.block=function(){n.blockUI({message:'working on it...<img src="/content/loading.gif"/>'})},n.unblock=function(){n.unblockUI({fadeOut:150})},n.navigate=function(n,t){n+=(n.match(/\?/)?"&":"?")+t,window.location=n},n.fn.showhide=function(t){return t?n(this).show():n(this).hide(),this},n.fn.enabled=function(t){return t?n(this).attr("href","#").removeClass("disabled"):n(this).removeAttr("href").addClass("disabled"),this},n.fn.fillOptions=function(t,i){var u="",r;if(t)for(r=0;r<t.length;r++)u+='<option value="'+t[r].Value+'"',t[r].Selected&&(u+=" selected='selected'"),u+=">"+t[r].Text+"</option>";return this.each(function(){var t="<select id='"+this.id+"' name='"+this.id+"'";i&&(t+=" multiple='multiple'"),t+=">"+u+"</select>",n(this).replaceWith(t)})},n.fn.multiSelectRemove=function(){return n(this).each(function(){n(this).next(".multiselect").remove(),n(this).next(".multiSelectOptions").remove()}),n(this)}}(jQuery),function(n){var t={};n.fn.SelectCondition=function(){return n("#QueryConditionSelect").dialog({overlay:{background:"#000",opacity:.3},bgiframe:!0,modal:!0,autoOpen:!1,closeOnEscape:!0,width:750,height:575,position:"top"}),n("#tabber").tabs(),this.click(function(){return t.Id=this.id,n("#QueryConditionSelect").dialog("open"),!1}),n("div.FieldLink a").click(function(t){return n.post("/QueryBuilder/SelectCondition/",{ConditionName:t.target.id,Id:n("#SelectedId").val()},function(t){n("#QueryConditionSelect").dialog("close"),UpdateView(t)}),!1}),n("a.closeit").click(function(){n.unblockUI()}),this}}(jQuery)